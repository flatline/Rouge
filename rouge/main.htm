<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
  <head>
	<title>Rouge</title>
	
	<script type="text/javascript" src="jquery/jquery-1.3.2.min.js"></script>
	<script type="text/javascript" src="jquery/jquery-json.min.js" ></script>
	<script type="text/javascript" src="scripts/common.js"></script>
	<script type="text/javascript" src="scripts/map.js"></script>
	<script type="text/javascript" src="scripts/controller.js"></script>
	<script type="text/javascript" src="scripts/actors.js"></script>	
	<script type="text/javascript" src="scripts/player.js"></script> 
	<script type="text/javascript" src="scripts/npc.js"></script>
	<script type="text/javascript" src="scripts/frame.js"></script>
	<script type="text/javascript" src="scripts/gamestorage.js"></script>
	<script type="text/javascript" src="scripts/imageTable.js"></script>
	<script type="text/javascript" src="scripts/fov.js"></script>
	<script type="text/javascript" src="scripts/view.js"></script>
	<script type="text/javascript" src="scripts/pickler.js"></script>
	<script type="text/javascript">	   

      /**
	   * Debug - lays down a default set of tiles ('.') on each square of a map.
	   * @param {Map} map - the map to tile 
	   */
      function tileMap(map) {
		  var width = map.width;
		  var height = map.height;
		  for (var i = 0; i < height; i++) {
			  for (var j =0; j < width; j++) {
				  map.poke({ repr: "grounds:1,0", "static": true }, i, j);
			  }			
		  }		 
	  }

	  function newGameController() {
			var map = new Map();
			map.init(30, 30);
			tileMap(map);
			
			var controller = new Controller(map);

			var player = new Player();
			map.player = player;
			map.poke(player, 1, 1);

			for (var i = 0; i < 3; i++) {
				   var orc = new NPC();
				   orc.repr = "monster1:3,1";
				orc.id = world.getID();									   
				map.poke(orc, 15, i);
				controller.schedule(orc, 1000);
			}
			return controller;
		}
	
	   $(".gameLink").live("click", function(evt) {
		   var key = $(evt.target).attr("data-gamekey");
		   var controller;
		   if (key == "new") {
			   controller = newGameController();
		   } else {
			   controller = gameStorage.loadGame(key);
		   }
		   
		   $("#gameList").hide();
		   
		   var view = new HtmlMapView(controller);
			view.init();
			evt.stopPropagation();
			return false;
	   });
	
		$(document).ready(function() {
			var gameList = $("#gameList");
			var games = gameStorage.listGames();
			for (var i = 0; i < games.length; i++) {
				gameList.append('<li><a class="gameLink" data-gamekey="' + games[i] + '" href="#">' + games[i] + '</a></li>');
			}
		});
	</script>
	
	<style type="text/css">
		canvas
		{
			border: 1px solid black;
		}
	</style>
</head>
<body>
    <div id="game_view"></div>
	<ul id="gameList">
		<li><a class="gameLink" data-gamekey="new" href="#">New Game</a></li>
	</ul>
</body>
</html>
